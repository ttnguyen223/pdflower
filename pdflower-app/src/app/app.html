<!-- Reduce the visual weight of the banner -->
<div class="banner">
  <a routerLink="/">
    <img src="assets/banner.jpg" alt="Hoa tươi Buôn Ma Thuột, Đắk Lắk - PDflower" class="banner-image" />
  </a>
</div>

<mat-toolbar color="primary" class="main-navbar">
  <button mat-icon-button routerLink="/" aria-label="Go home">
    <mat-icon>home</mat-icon>
  </button>

  <span class="navbar-spacer"></span>

  @if (user$ | async; as user) {
    <span class="user-email-display">{{ user.email }}</span>
  }
   <button mat-icon-button 
          [matMenuTriggerFor]="accountMenu" 
          class="account-icon-wrapper"
          aria-label="Account menu">
    <mat-icon>account_circle</mat-icon>
  </button>

  @if (showCart) {
  <a
    [matBadge]="cartService.cartItemCount()"
    matBadgeColor="warn"
    [matBadgeHidden]="cartService.cartItemCount() === 0"
    class="cart-link-wrapper"
    (click)="goToCart()"
  >
    <button mat-icon-button>
      <mat-icon>shopping_cart</mat-icon>
    </button>
  </a>
  }

</mat-toolbar>

<!-- Define the Account Menu Template -->
<mat-menu #accountMenu="matMenu">
  <!-- Check user status using async pipe -->
  @if (user$ | async; as user) {
    <!-- Option for logged-in users -->
    @if (isAdmin$ | async; as isAdmin) {
      @if (isAdmin) {
        <button mat-menu-item routerLink="/admin">
          <mat-icon>dashboard</mat-icon>
          <span>Quản lý sản phẩm</span>
        </button>
      }
    } @else {
      <!-- Display a small spinner while isAdmin$ is resolving -->
      <div style="display: flex; justify-content: center; padding: 12px;">
        <mat-spinner diameter="24"></mat-spinner>
      </div>
    }
    <button mat-menu-item (click)="onLogout()">
      <mat-icon>logout</mat-icon>
      <span>Logout</span>
    </button>
  } @else {
    <!-- Option for logged-out users -->
    <button mat-menu-item routerLink="/login">
      <mat-icon>login</mat-icon>
      <span>Login</span>
    </button>
  }
</mat-menu>

@if (loading) {
  <div class="loading-overlay">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
}

<main>
  <router-outlet></router-outlet>
</main>
